plugins {
    id 'com.android.application'
    id 'kotlin-android'
    id 'kotlin-kapt'
    id 'dagger.hilt.android.plugin'
    id 'com.google.firebase.crashlytics'
    id 'com.google.gms.google-services'
}

android {
    compileSdkVersion versions.compileSdk
    defaultConfig {
        applicationId "org.hzontal.tella"
        minSdkVersion versions.minSdk
        compileSdkVersion versions.compileSdk
        targetSdkVersion versions.targetSdk
        versionCode 153
        versionName "2.1.0"
        multiDexEnabled true
        // vectorDrawables.useSupportLibrary = true // don't care about apk size, care about crashes
    }

    configurations.all {
        // resolutionStrategy.force "com.android.support:exifinterface:${supportLibVersion}"
        // resolutionStrategy.force "com.android.support:animated-vector-drawble:${supportLibVersion}"
        // resolutionStrategy.force "com.android.support:support-v13:${supportLibVersion}"
    }

    buildTypes {
        debug {
            debuggable true
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
        release {
            debuggable false
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    compileOptions {
        // Flag to enable support for the new language APIs
        coreLibraryDesugaringEnabled = true

        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = '1.8'
    }
    buildFeatures {
        viewBinding = true
    }
    lintOptions {
        checkReleaseBuilds false
    }
    hilt {
        enableExperimentalClasspathAggregation = true
    }
}

dependencies {
    coreLibraryDesugaring "com.android.tools:desugar_jdk_libs:$versions.desugar"
    implementation "androidx.multidex:multidex:$versions.multidex"
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation project(':tella-vault')
    implementation project(':clean-insights')
    api project(':tella-locking-ui')

    implementation "androidx.lifecycle:lifecycle-extensions:$versions.lifecycleExtensions"

    implementation platform("com.google.firebase:firebase-bom:$versions.firebaseBom")
    implementation 'com.google.firebase:firebase-crashlytics'

    api "androidx.navigation:navigation-fragment-ktx:$versions.navigationFragmentKtx"
    api "androidx.navigation:navigation-ui-ktx:$versions.navigationUI"
    implementation "androidx.appcompat:appcompat:$versions.appcompat"
    implementation "androidx.cardview:cardview:$versions.cardview"
    implementation "androidx.legacy:legacy-support-v4:$versions.legacyV4"
    implementation "androidx.exifinterface:exifinterface:$versions.exifinterface"
    implementation "com.google.android.gms:play-services-location:$versions.googlePlayServices"
    implementation "com.google.android.gms:play-services-maps:$versions.googlePlayServices"
    // implementation "com.google.android.gms:play-services-gcm:$versions.googlePlayServices" // android-job, optional

    implementation "com.squareup.retrofit2:retrofit:${versions.retrofit}"
    implementation "com.squareup.retrofit2:adapter-rxjava2:${versions.retrofit}"
    implementation "com.squareup.retrofit2:converter-gson:${versions.retrofit}"
    implementation("com.squareup.retrofit2:converter-simplexml:${versions.retrofit}") {
        exclude group: 'xpp3', module: 'xpp3'
        exclude group: 'stax', module: 'stax-api'
        exclude group: 'stax', module: 'stax'
    }
    implementation "com.jakewharton.retrofit:retrofit2-kotlin-coroutines-adapter:$versions.retrofit2KotliCoroutinesAdapter"

    apply plugin: 'kotlin-kapt'
    implementation("com.github.permissions-dispatcher:permissionsdispatcher:$versions.permissionDispatcher") {
        exclude module: "support-v13"
    }
    implementation "org.jetbrains.kotlin:kotlin-stdlib:$versions.kotlin"
    implementation "androidx.navigation:navigation-runtime-ktx:$versions.navigationRuntime"
    implementation "androidx.navigation:navigation-fragment-ktx:$versions.navigationFragment"
    implementation "androidx.databinding:databinding-runtime:$versions.databindingRuntime"
    annotationProcessor "org.permissionsdispatcher:permissionsdispatcher-processor:$versions.permissionDispatcher"

    implementation "com.squareup.okhttp3:logging-interceptor:$versions.okhttp3LoggingInterceptor"
    implementation "com.squareup:tape:$versions.squareupTape" // todo: follow this, v2 should be soon
    implementation "com.jakewharton.timber:timber:$versions.timber"
    implementation "net.zetetic:android-database-sqlcipher:${versions.sqlcipher}@aar"
    implementation "info.guardianproject.cacheword:cachewordlib:$versions.cacheword"
    implementation "com.github.bumptech.glide:glide:$versions.glide"
    implementation "io.reactivex.rxjava2:rxandroid:$versions.rxandroid"
    implementation "com.jakewharton.rxrelay2:rxrelay:$versions.rxrelay"
    implementation "com.evernote:android-job:$versions.evernoteJob"

    // digest auth
    implementation "com.burgstaller:okhttp-digest:$versions.burgstallerOkhttpDigest"

    // collect
    //implementation group: "org.getodk", name: "javarosa", version: "$versions.javarosa"
    implementation "org.opendatakit:opendatakit-javarosa:$versions.javarosa"
    implementation "net.sf.kxml:kxml2:$versions.kxml2"
    implementation "commons-io:commons-io:$versions.commonsIo"


    // exo
    implementation "com.google.android.exoplayer:exoplayer:$versions.exoplayer"

    // camera
    implementation("com.otaliastudios:cameraview:$versions.cameraview") {
        exclude module: "exifinterface"
        exclude module: "animated-vector-drawble"
    }

    //hilt
    implementation "com.google.dagger:hilt-android:$versions.hilt_android"
    kapt "com.google.dagger:hilt-android-compiler:$versions.hilt_android_compiler"
    //hilt-view-model
    implementation "androidx.hilt:hilt-lifecycle-viewmodel:$versions.hilt_viewmodel"
    kapt "androidx.hilt:hilt-compiler:$versions.hilt_version"

    implementation "com.simplify:ink:$versions.simplifyInk"
    implementation "com.mikhaellopez:circularimageview:$versions.circularimageview"
    implementation "org.apache.directory.studio:org.apache.commons.io:$versions.apacheCommonsIo"

    //worker manager
    implementation "androidx.work:work-runtime-ktx:$versions.workermanger"
    implementation("androidx.hilt:hilt-work:$versions.hilt_version")

    //optional - RxJava2 support
    implementation "androidx.work:work-rxjava2:$versions.workermanger"

    debugImplementation "com.squareup.leakcanary:leakcanary-android:$versions.leakCanaryVersion"

    testImplementation "junit:junit:$versions.junit"
}